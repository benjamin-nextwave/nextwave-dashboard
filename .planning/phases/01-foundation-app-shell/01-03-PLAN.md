---
phase: 01-foundation-app-shell
plan: 03
type: tdd
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/lib/overdue.ts
  - src/lib/__tests__/overdue.test.ts
autonomous: true

must_haves:
  truths:
    - "computeOverdue returns effective_deadline = today when task is overdue and not completed"
    - "computeOverdue returns effective_deadline = original deadline when task is not overdue"
    - "computeOverdue returns effective_deadline = original deadline when task is completed (even if past)"
    - "computeOverdue returns correct daysOverdue count for overdue incomplete tasks"
    - "computeOverdue returns daysOverdue = 0 for non-overdue or completed tasks"
  artifacts:
    - path: "src/lib/overdue.ts"
      provides: "Overdue-rolling computation function"
      exports: ["computeOverdue", "OverdueResult"]
    - path: "src/lib/__tests__/overdue.test.ts"
      provides: "Test suite for overdue computation"
      contains: "computeOverdue"
  key_links:
    - from: "src/lib/overdue.ts"
      to: "date-fns"
      via: "differenceInCalendarDays and parseISO imports"
      pattern: "differenceInCalendarDays"
---

<objective>
Implement the overdue-rolling computation using TDD (Red-Green-Refactor cycle).

Purpose: This is the core business logic of the entire application. Every task deadline display depends on this function being correct. TDD ensures all edge cases are covered before any UI code touches it.
Output: A tested, working computeOverdue function with full test coverage.
</objective>

<execution_context>
@C:\Users\bstei\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bstei\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-app-shell/01-RESEARCH.md
</context>

<feature>
  <name>Overdue-Rolling Computation</name>
  <files>src/lib/overdue.ts, src/lib/__tests__/overdue.test.ts</files>
  <behavior>
    computeOverdue(deadline: string, today: string, isCompleted: boolean) -> OverdueResult

    OverdueResult = {
      effectiveDeadline: string,   // ISO date 'YYYY-MM-DD'
      originalDeadline: string,    // ISO date 'YYYY-MM-DD'
      daysOverdue: number,         // 0 if not overdue
      isOverdue: boolean
    }

    Test cases (all dates are ISO strings 'YYYY-MM-DD'):

    Case 1 - Task is overdue (incomplete, deadline in past):
      computeOverdue("2025-01-10", "2025-01-15", false)
      -> { effectiveDeadline: "2025-01-15", originalDeadline: "2025-01-10", daysOverdue: 5, isOverdue: true }

    Case 2 - Task is not overdue (incomplete, deadline is today):
      computeOverdue("2025-01-15", "2025-01-15", false)
      -> { effectiveDeadline: "2025-01-15", originalDeadline: "2025-01-15", daysOverdue: 0, isOverdue: false }

    Case 3 - Task is not overdue (incomplete, deadline in future):
      computeOverdue("2025-01-20", "2025-01-15", false)
      -> { effectiveDeadline: "2025-01-20", originalDeadline: "2025-01-20", daysOverdue: 0, isOverdue: false }

    Case 4 - Completed task with past deadline (NOT overdue):
      computeOverdue("2025-01-10", "2025-01-15", true)
      -> { effectiveDeadline: "2025-01-10", originalDeadline: "2025-01-10", daysOverdue: 0, isOverdue: false }

    Case 5 - Completed task with future deadline:
      computeOverdue("2025-01-20", "2025-01-15", true)
      -> { effectiveDeadline: "2025-01-20", originalDeadline: "2025-01-20", daysOverdue: 0, isOverdue: false }

    Case 6 - Task overdue by 1 day (boundary):
      computeOverdue("2025-01-14", "2025-01-15", false)
      -> { effectiveDeadline: "2025-01-15", originalDeadline: "2025-01-14", daysOverdue: 1, isOverdue: true }

    Case 7 - Task overdue by large amount:
      computeOverdue("2025-01-01", "2025-02-01", false)
      -> { effectiveDeadline: "2025-02-01", originalDeadline: "2025-01-01", daysOverdue: 31, isOverdue: true }

    Key business rules:
    - effective_deadline = max(deadline, today) -- but only for incomplete overdue tasks
    - Completed tasks ALWAYS show their original deadline regardless of date
    - daysOverdue = differenceInCalendarDays(today, deadline) when overdue and incomplete
    - A task due today (deadline === today) is NOT overdue
    - String comparison works for ISO dates: "2025-01-10" < "2025-01-15" is true
  </behavior>
  <implementation>
    Implementation approach (after tests pass RED phase):

    1. Export OverdueResult interface with effectiveDeadline, originalDeadline, daysOverdue, isOverdue fields
    2. Export computeOverdue function that:
       a) Determines isOverdue = !isCompleted AND deadline < today (ISO string comparison)
       b) Sets effectiveDeadline = isOverdue ? today : deadline
       c) Computes daysOverdue = isOverdue ? differenceInCalendarDays(parseISO(today), parseISO(deadline)) : 0
       d) Returns { effectiveDeadline, originalDeadline: deadline, daysOverdue, isOverdue }

    Dependencies: differenceInCalendarDays and parseISO from date-fns

    NOTE: Before writing tests, ensure a test runner is configured. Check if vitest or jest is available. If neither is installed:
    - Install vitest (lighter, faster, native ESM): `npm install -D vitest`
    - Add test script to package.json: `"test": "vitest run"`, `"test:watch": "vitest"`
    - Vitest works out of the box with TypeScript and path aliases from tsconfig
  </implementation>
</feature>

<output>
After completion, create `.planning/phases/01-foundation-app-shell/01-03-SUMMARY.md`
</output>
