---
phase: 01-foundation-app-shell
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/lib/dates.ts
  - src/lib/today-provider.tsx
  - src/components/theme-provider.tsx
  - src/components/theme-toggle.tsx
autonomous: true

must_haves:
  truths:
    - "formatDutchDate returns Dutch-formatted date strings with correct locale"
    - "formatDutchDateCapitalized returns capitalized Dutch date for headers"
    - "getToday returns today's date in Europe/Amsterdam timezone"
    - "getWeekStart returns Monday as the first day of the week"
    - "TodayProvider supplies consistent today string to all child components"
    - "ThemeProvider enables dark/light mode switching without hydration flash"
    - "ThemeToggle button switches between dark and light themes"
  artifacts:
    - path: "src/lib/dates.ts"
      provides: "Timezone-aware date utilities with Dutch locale"
      exports: ["getToday", "getTodayISO", "formatDutchDate", "formatDutchDateCapitalized", "formatShortDate", "getWeekStart", "TIMEZONE"]
    - path: "src/lib/today-provider.tsx"
      provides: "React context for consistent today date across app"
      exports: ["TodayProvider", "useToday"]
    - path: "src/components/theme-provider.tsx"
      provides: "next-themes wrapper for dark/light mode"
      exports: ["ThemeProvider"]
    - path: "src/components/theme-toggle.tsx"
      provides: "Toggle button for dark/light mode switch"
      exports: ["ThemeToggle"]
  key_links:
    - from: "src/lib/today-provider.tsx"
      to: "src/lib/dates.ts"
      via: "getTodayISO() call for date computation"
      pattern: "getTodayISO"
    - from: "src/components/theme-toggle.tsx"
      to: "next-themes"
      via: "useTheme hook"
      pattern: "useTheme"
    - from: "src/components/theme-provider.tsx"
      to: "next-themes"
      via: "ThemeProvider wrapper"
      pattern: "NextThemesProvider"
---

<objective>
Create the date utility library with Amsterdam timezone and Dutch locale, the TodayProvider context, and the dark/light mode theme system.

Purpose: These are the shared utilities that the navigation, overdue computation, and all future feature components depend on. Date utilities ensure consistent Dutch formatting and Amsterdam timezone across the entire app. The theme system enables dark/light mode without hydration flash.
Output: Four library/component files providing date utilities, today context, and theme switching.
</objective>

<execution_context>
@C:\Users\bstei\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bstei\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-app-shell/01-RESEARCH.md
@.planning/phases/01-foundation-app-shell/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create date utility library and TodayProvider</name>
  <files>
    src/lib/dates.ts
    src/lib/today-provider.tsx
  </files>
  <action>
    1. Create `src/lib/dates.ts` with these exports:
       - `TIMEZONE = 'Europe/Amsterdam'` (exported constant)
       - `getToday()`: Returns `startOfDay(TZDate.tz(TIMEZONE))` as a TZDate -- today at midnight Amsterdam time
       - `getTodayISO()`: Returns today as 'yyyy-MM-dd' string using `format(TZDate.tz(TIMEZONE), 'yyyy-MM-dd')`
       - `formatDutchDate(date: Date | string)`: Parses string input with parseISO, formats as `'EEEE d MMMM yyyy'` with `{ locale: nl }`. Returns lowercase Dutch like "maandag 10 februari 2025"
       - `formatDutchDateCapitalized(date: Date | string)`: Calls formatDutchDate then capitalizes first letter. Returns "Maandag 10 februari 2025"
       - `formatShortDate(date: Date | string)`: Formats as `'d MMM yyyy'` with `{ locale: nl }`. Returns "10 feb 2025"
       - `getWeekStart(date: Date)`: Returns `startOfWeek(date, { weekStartsOn: 1, locale: nl })` -- Monday as first day

       Imports:
       - `TZDate` from `@date-fns/tz`
       - `format`, `startOfDay`, `startOfWeek`, `parseISO` from `date-fns`
       - `nl` from `date-fns/locale/nl`

    2. Create `src/lib/today-provider.tsx` as a 'use client' component:
       - Create TodayContext using createContext with empty string default
       - `TodayProvider`: useState initialized with `getTodayISO()`. useEffect that:
         a) Sets interval every 60 seconds checking if date changed (compare getTodayISO() with current state)
         b) Adds visibilitychange listener that checks date on tab focus (handles sleep/wake)
         c) Cleans up both on unmount
       - `useToday()`: useContext hook that throws if used outside TodayProvider
       - Export both TodayProvider and useToday

    IMPORTANT:
    - Import TZDate from '@date-fns/tz' (NOT from 'date-fns-tz')
    - Import nl locale from 'date-fns/locale/nl' (NOT from 'date-fns/locale')
    - Always pass weekStartsOn: 1 for Monday start (Dutch convention)
    - The TodayProvider must be a client component ('use client' directive)
    - The dates.ts file should NOT have 'use client' -- it's a pure utility usable from both server and client
  </action>
  <verify>
    `npx tsc --noEmit` passes without errors.
    Create a quick test: in a temporary script or browser console, verify formatDutchDate("2025-02-10") returns a string containing "februari" and "2025".
    Verify getWeekStart returns a Monday by checking the day of week.
  </verify>
  <done>
    Date utility module exports all 7 functions/constants. TodayProvider exports context provider and useToday hook. All date formatting uses Dutch locale. All timezone computation uses Europe/Amsterdam. Week starts on Monday.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create dark/light mode theme system</name>
  <files>
    src/components/theme-provider.tsx
    src/components/theme-toggle.tsx
  </files>
  <action>
    1. Create `src/components/theme-provider.tsx` as a 'use client' component:
       - Import ThemeProvider as NextThemesProvider from 'next-themes'
       - Create ThemeProvider component that passes through all props to NextThemesProvider
       - Use `React.ComponentProps<typeof NextThemesProvider>` for prop types
       - Export as named export `ThemeProvider`

    2. Create `src/components/theme-toggle.tsx` as a 'use client' component:
       - Import useTheme from 'next-themes'
       - Import Button from '@/components/ui/button'
       - Import Sun and Moon icons from 'lucide-react'
       - Create ThemeToggle component:
         a) Uses useTheme() to get theme and setTheme
         b) Renders a ghost variant, icon-size Button
         c) onClick toggles between 'dark' and 'light'
         d) Sun icon visible in light mode (hidden in dark via dark: classes)
         e) Moon icon visible in dark mode (hidden in light via dark: classes)
         f) aria-label="Thema wisselen" (Dutch)
       - Export as named export `ThemeToggle`

    IMPORTANT:
    - Both files need 'use client' directive (they use browser APIs / React hooks)
    - The ThemeToggle uses the Sun/Moon icon swap pattern from shadcn docs (CSS transitions, not conditional rendering) to avoid hydration mismatch
    - Use `variant="ghost"` and `size="icon"` on the Button
    - The Moon icon needs `absolute` positioning to overlay the Sun icon position
  </action>
  <verify>
    `npx tsc --noEmit` passes.
    Verify src/components/theme-provider.tsx exports ThemeProvider.
    Verify src/components/theme-toggle.tsx exports ThemeToggle.
    Both files are 'use client' components.
  </verify>
  <done>
    ThemeProvider wraps next-themes for the app. ThemeToggle provides a button that switches between dark and light modes with Sun/Moon icons and Dutch aria-label. Both are client components ready to be composed into the layout.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with all new files
- `npm run build` succeeds
- src/lib/dates.ts exports getToday, getTodayISO, formatDutchDate, formatDutchDateCapitalized, formatShortDate, getWeekStart, TIMEZONE
- src/lib/today-provider.tsx exports TodayProvider and useToday
- src/components/theme-provider.tsx exports ThemeProvider
- src/components/theme-toggle.tsx exports ThemeToggle
</verification>

<success_criteria>
Date utilities produce Dutch-formatted dates in Amsterdam timezone with Monday week starts. TodayProvider supplies a consistent today string that refreshes at midnight or on tab focus. Theme system is ready for integration into the root layout (Plan 04 handles the wiring).
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-app-shell/01-02-SUMMARY.md`
</output>
