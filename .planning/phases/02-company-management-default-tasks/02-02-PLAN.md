---
phase: 02-company-management-default-tasks
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/companies.ts
  - src/lib/tasks.ts
  - src/components/ui/card.tsx
  - src/components/ui/input.tsx
  - src/components/ui/textarea.tsx
  - src/components/ui/dialog.tsx
  - src/components/ui/badge.tsx
  - src/components/ui/label.tsx
  - src/components/ui/separator.tsx
autonomous: true

must_haves:
  truths:
    - "Company CRUD functions connect to Supabase and return typed data"
    - "Task query functions return typed task arrays filtered by company"
    - "All required shadcn/ui components are installed and importable"
  artifacts:
    - path: "src/lib/companies.ts"
      provides: "Supabase CRUD for companies"
      exports: ["getCompaniesWithOpenTaskCounts", "getCompanyById", "createCompany", "updateCompany"]
    - path: "src/lib/tasks.ts"
      provides: "Supabase CRUD for tasks"
      exports: ["insertDefaultTasks", "getTasksByCompanyId"]
    - path: "src/components/ui/card.tsx"
      provides: "shadcn Card component"
    - path: "src/components/ui/dialog.tsx"
      provides: "shadcn Dialog component"
    - path: "src/components/ui/input.tsx"
      provides: "shadcn Input component"
    - path: "src/components/ui/textarea.tsx"
      provides: "shadcn Textarea component"
    - path: "src/components/ui/badge.tsx"
      provides: "shadcn Badge component"
    - path: "src/components/ui/label.tsx"
      provides: "shadcn Label component"
    - path: "src/components/ui/separator.tsx"
      provides: "shadcn Separator component"
  key_links:
    - from: "src/lib/companies.ts"
      to: "src/lib/supabase.ts"
      via: "supabase import"
      pattern: "import.*supabase.*from.*@/lib/supabase"
    - from: "src/lib/tasks.ts"
      to: "src/lib/supabase.ts"
      via: "supabase import"
      pattern: "import.*supabase.*from.*@/lib/supabase"
    - from: "src/lib/companies.ts"
      to: "src/types/database.ts"
      via: "type imports"
      pattern: "import.*type.*Company.*from.*@/types/database"
---

<objective>
Install shadcn/ui components and create the Supabase data access layer for companies and tasks.

Purpose: Both the company overview page and company detail page need data access functions and UI components. Installing these as a foundation enables Plan 03 (overview) and Plan 04 (detail) to run in parallel in Wave 2 without worrying about missing imports.

Output: `companies.ts` and `tasks.ts` data modules, plus 7 shadcn/ui components ready for use.
</objective>

<execution_context>
@C:\Users\bstei\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bstei\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-company-management-default-tasks/02-RESEARCH.md

@src/types/database.ts
@src/lib/supabase.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn/ui components</name>
  <files>
    src/components/ui/card.tsx
    src/components/ui/input.tsx
    src/components/ui/textarea.tsx
    src/components/ui/dialog.tsx
    src/components/ui/badge.tsx
    src/components/ui/label.tsx
    src/components/ui/separator.tsx
  </files>
  <action>
    Run the shadcn CLI to install all needed components in a single command:

    ```bash
    npx shadcn@latest add card input textarea dialog badge label separator --yes
    ```

    The `--yes` flag accepts defaults. These components will be generated into `src/components/ui/` following the existing pattern from button.tsx.

    After installation, verify each component file exists and exports correctly. The project uses the unified `radix-ui` package (already in package.json), so all generated components should import from `radix-ui` not individual `@radix-ui/*` packages.

    Note: Do NOT install `field` component -- it may not be available in all shadcn versions. Use Label + Input/Textarea directly for form fields.
  </action>
  <verify>
    - Run `ls src/components/ui/` and confirm: button.tsx, card.tsx, input.tsx, textarea.tsx, dialog.tsx, badge.tsx, label.tsx, separator.tsx all exist
    - Run `npx tsc --noEmit` to confirm no TypeScript errors from new components
  </verify>
  <done>All 7 shadcn/ui components are installed in src/components/ui/ and compile without TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 2: Create Supabase data access layer for companies and tasks</name>
  <files>
    src/lib/companies.ts
    src/lib/tasks.ts
  </files>
  <action>
    Create `src/lib/companies.ts` with these functions:

    1. `getCompaniesWithOpenTaskCounts()` -- Fetches all companies with their incomplete task count:
       - Query: `supabase.from('companies').select('*, tasks(id, is_completed)').order('created_at', { ascending: false })`
       - Map results to add `open_task_count: company.tasks.filter(t => !t.is_completed).length`
       - Return type: `(Company & { open_task_count: number })[]`
       - Use client-side filtering for open count (not embedded filter syntax -- avoids Supabase query edge cases per RESEARCH.md Open Question 1)

    2. `getCompanyById(id: string)` -- Fetches single company:
       - Query: `.from('companies').select('*').eq('id', id).single()`
       - Return type: `Company | null`

    3. `createCompany(company: { name: string; warmup_start_date: string; go_live_date: string | null })` -- Inserts new company:
       - Query: `.from('companies').insert(company).select().single()`
       - Return type: `Company`

    4. `updateCompany(id: string, updates: Partial<...>)` -- Patches specific fields:
       - Query: `.from('companies').update(updates).eq('id', id).select().single()`
       - Updates parameter type: `Partial<Omit<Company, 'id' | 'created_at' | 'updated_at'>>`
       - Return type: `Company`
       - IMPORTANT: Send only changed fields (partial update), not entire company object. This prevents race conditions with auto-save (see RESEARCH.md Pitfall 4).

    Create `src/lib/tasks.ts` with these functions:

    1. `insertDefaultTasks(tasks: Omit<Task, 'id' | 'created_at'>[])` -- Batch inserts tasks:
       - Query: `.from('tasks').insert(tasks).select()`
       - Return type: `Task[]`

    2. `getTasksByCompanyId(companyId: string)` -- Fetches tasks for a company:
       - Query: `.from('tasks').select('*').eq('company_id', companyId).order('deadline', { ascending: true })`
       - Return type: `Task[]`

    Both files import `supabase` from `@/lib/supabase` and types from `@/types/database`.
    Both files throw on error (let caller handle errors).
    No 'use client' directive needed -- these are plain TypeScript modules usable from both server and client.
  </action>
  <verify>
    - Run `npx tsc --noEmit` -- no TypeScript errors
    - Verify exports: `grep -n "export" src/lib/companies.ts src/lib/tasks.ts` shows all expected function exports
  </verify>
  <done>companies.ts exports 4 functions (getCompaniesWithOpenTaskCounts, getCompanyById, createCompany, updateCompany) and tasks.ts exports 2 functions (insertDefaultTasks, getTasksByCompanyId), all typed against Database types, all compiling without errors</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes (all new files compile)
- All 7 UI components exist in src/components/ui/
- companies.ts and tasks.ts exist with correct exports
- `npm run build` succeeds (no build errors from new files)
</verification>

<success_criteria>
- shadcn/ui card, input, textarea, dialog, badge, label, separator components installed and importable
- companies.ts provides getCompaniesWithOpenTaskCounts, getCompanyById, createCompany, updateCompany
- tasks.ts provides insertDefaultTasks, getTasksByCompanyId
- All functions are typed with Company/Task types from database.ts
- Project builds successfully with `npm run build`
</success_criteria>

<output>
After completion, create `.planning/phases/02-company-management-default-tasks/02-02-SUMMARY.md`
</output>
